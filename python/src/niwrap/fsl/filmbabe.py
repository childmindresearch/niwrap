# This file was auto generated by Styx.
# Do not edit this file directly.

import typing
import pathlib
from styxdefs import *
import dataclasses

FILMBABE_METADATA = Metadata(
    id="fc1cf8c447adde61838a84eeeddceca8e8eca59e.boutiques",
    name="filmbabe",
    package="fsl",
    container_image_tag="brainlife/fsl:6.0.4-patched2",
)
FilmbabeParameters = typing.TypedDict('FilmbabeParameters', {
    "__STYX_TYPE__": typing.Literal["filmbabe"],
    "datafile_alias": InputPathType,
    "mask_alias": InputPathType,
    "designfile_alias_2": InputPathType,
    "frf": InputPathType,
    "verbose_flag_alias": bool,
    "debug_level_alias_2": typing.NotRequired[str | None],
    "timing_on_flag": bool,
    "help_flag_alias": bool,
    "flobs_prior_off_alias": bool,
    "flobs_dir": typing.NotRequired[str | None],
    "prior_covar_file_alias": typing.NotRequired[InputPathType | None],
    "prior_mean_file_alias": typing.NotRequired[InputPathType | None],
    "log_dir_alias_2": typing.NotRequired[str | None],
    "num_iterations": typing.NotRequired[int | None],
    "temporal_ar_mrf_prec_alias": typing.NotRequired[float | None],
    "temporal_ar_flag": bool,
    "num_trace_samples_alias": typing.NotRequired[int | None],
    "temporal_ar_order": typing.NotRequired[int | None],
})


def dyn_cargs(
    t: str,
) -> None:
    """
    Get build cargs function by command type.
    
    Args:
        t: Command type.
    Returns:
        Build cargs function.
    """
    vt = {
        "filmbabe": filmbabe_cargs,
    }
    return vt.get(t)


def dyn_outputs(
    t: str,
) -> None:
    """
    Get build outputs function by command type.
    
    Args:
        t: Command type.
    Returns:
        Build outputs function.
    """
    vt = {
        "filmbabe": filmbabe_outputs,
    }
    return vt.get(t)


class FilmbabeOutputs(typing.NamedTuple):
    """
    Output object returned when calling `filmbabe(...)`.
    """
    root: OutputPathType
    """Output root folder. This is the root folder for all outputs."""
    output_dir: OutputPathType
    """Output directory"""


def filmbabe_params(
    datafile_alias: InputPathType,
    mask_alias: InputPathType,
    designfile_alias_2: InputPathType,
    frf: InputPathType,
    verbose_flag_alias: bool = False,
    debug_level_alias_2: str | None = None,
    timing_on_flag: bool = False,
    help_flag_alias: bool = False,
    flobs_prior_off_alias: bool = False,
    flobs_dir: str | None = None,
    prior_covar_file_alias: InputPathType | None = None,
    prior_mean_file_alias: InputPathType | None = None,
    log_dir_alias_2: str | None = None,
    num_iterations: int | None = 5,
    temporal_ar_mrf_prec_alias: float | None = -1,
    temporal_ar_flag: bool = False,
    num_trace_samples_alias: int | None = 0,
    temporal_ar_order: int | None = 3,
) -> FilmbabeParameters:
    """
    Build parameters.
    
    Args:
        datafile_alias: Data file.
        mask_alias: Mask file.
        designfile_alias_2: Design matrix file.
        frf: File indicating which regressors belong to which original EV\
            design matrix file (a -1 label indicates a non-flobs regressor).
        verbose_flag_alias: Switch on diagnostic messages.
        debug_level_alias_2: Set debug level.
        timing_on_flag: Turn timing on.
        help_flag_alias: Display help message.
        flobs_prior_off_alias: Turn FLOBS prior off.
        flobs_dir: FLOBS directory; required when using FLOBS constraints.
        prior_covar_file_alias: Prior covariance matrix file.
        prior_mean_file_alias: Prior mean matrix file.
        log_dir_alias_2: Log directory.
        num_iterations: Number of VB iterations; default is 5.
        temporal_ar_mrf_prec_alias: MRF precision to impose on temporal AR\
            maps, default is -1 for a proper full Bayes approach.
        temporal_ar_flag: Impose ARD/MRF on temporal AR.
        num_trace_samples_alias: Number of samples to take to estimate trace;\
            default is 0 (uses only diagonal elements of precision matrix to\
            estimate trace).
        temporal_ar_order: Order of temporal AR; default is 3.
    Returns:
        Parameter dictionary
    """
    params = {
        "__STYXTYPE__": "filmbabe",
        "datafile_alias": datafile_alias,
        "mask_alias": mask_alias,
        "designfile_alias_2": designfile_alias_2,
        "frf": frf,
        "verbose_flag_alias": verbose_flag_alias,
        "timing_on_flag": timing_on_flag,
        "help_flag_alias": help_flag_alias,
        "flobs_prior_off_alias": flobs_prior_off_alias,
        "temporal_ar_flag": temporal_ar_flag,
    }
    if debug_level_alias_2 is not None:
        params["debug_level_alias_2"] = debug_level_alias_2
    if flobs_dir is not None:
        params["flobs_dir"] = flobs_dir
    if prior_covar_file_alias is not None:
        params["prior_covar_file_alias"] = prior_covar_file_alias
    if prior_mean_file_alias is not None:
        params["prior_mean_file_alias"] = prior_mean_file_alias
    if log_dir_alias_2 is not None:
        params["log_dir_alias_2"] = log_dir_alias_2
    if num_iterations is not None:
        params["num_iterations"] = num_iterations
    if temporal_ar_mrf_prec_alias is not None:
        params["temporal_ar_mrf_prec_alias"] = temporal_ar_mrf_prec_alias
    if num_trace_samples_alias is not None:
        params["num_trace_samples_alias"] = num_trace_samples_alias
    if temporal_ar_order is not None:
        params["temporal_ar_order"] = temporal_ar_order
    return params


def filmbabe_cargs(
    params: FilmbabeParameters,
    execution: Execution,
) -> list[str]:
    """
    Build command-line arguments from parameters.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Command-line arguments.
    """
    cargs = []
    cargs.append("filmbabe")
    cargs.extend([
        "--datafile",
        execution.input_file(params.get("datafile_alias"))
    ])
    cargs.extend([
        "--mask",
        execution.input_file(params.get("mask_alias"))
    ])
    cargs.extend([
        "--designfile",
        execution.input_file(params.get("designfile_alias_2"))
    ])
    cargs.extend([
        "--frf",
        execution.input_file(params.get("frf"))
    ])
    if params.get("verbose_flag_alias"):
        cargs.append("--verbose")
    if params.get("debug_level_alias_2") is not None:
        cargs.extend([
            "--debuglevel",
            params.get("debug_level_alias_2")
        ])
    if params.get("timing_on_flag"):
        cargs.append("--to")
    if params.get("help_flag_alias"):
        cargs.append("--help")
    if params.get("flobs_prior_off_alias"):
        cargs.append("--flobsprioroff")
    if params.get("flobs_dir") is not None:
        cargs.extend([
            "--fd",
            params.get("flobs_dir")
        ])
    if params.get("prior_covar_file_alias") is not None:
        cargs.extend([
            "--priorcovarfile",
            execution.input_file(params.get("prior_covar_file_alias"))
        ])
    if params.get("prior_mean_file_alias") is not None:
        cargs.extend([
            "--priormeanfile",
            execution.input_file(params.get("prior_mean_file_alias"))
        ])
    if params.get("log_dir_alias_2") is not None:
        cargs.extend([
            "--logdir",
            params.get("log_dir_alias_2")
        ])
    if params.get("num_iterations") is not None:
        cargs.extend([
            "--ni",
            str(params.get("num_iterations"))
        ])
    if params.get("temporal_ar_mrf_prec_alias") is not None:
        cargs.extend([
            "--tarmrfprec",
            str(params.get("temporal_ar_mrf_prec_alias"))
        ])
    if params.get("temporal_ar_flag"):
        cargs.append("--tarard")
    if params.get("num_trace_samples_alias") is not None:
        cargs.extend([
            "--ntracesamps",
            str(params.get("num_trace_samples_alias"))
        ])
    if params.get("temporal_ar_order") is not None:
        cargs.extend([
            "--ntar",
            str(params.get("temporal_ar_order"))
        ])
    return cargs


def filmbabe_outputs(
    params: FilmbabeParameters,
    execution: Execution,
) -> FilmbabeOutputs:
    """
    Build outputs object containing output file paths and possibly stdout/stderr.
    
    Args:
        params: The parameters.
        execution: The execution object for resolving input paths.
    Returns:
        Outputs object.
    """
    ret = FilmbabeOutputs(
        root=execution.output_file("."),
        output_dir=execution.output_file("output"),
    )
    return ret


def filmbabe_execute(
    params: FilmbabeParameters,
    execution: Execution,
) -> FilmbabeOutputs:
    """
    FILM with MCMC-based Bayesian Analysis for fMRI.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        params: The parameters.
        execution: The execution object.
    Returns:
        NamedTuple of outputs (described in `FilmbabeOutputs`).
    """
    # validate constraint checks (or after middlewares?)
    cargs = filmbabe_cargs(params, execution)
    ret = filmbabe_outputs(params, execution)
    execution.run(cargs)
    return ret


def filmbabe(
    datafile_alias: InputPathType,
    mask_alias: InputPathType,
    designfile_alias_2: InputPathType,
    frf: InputPathType,
    verbose_flag_alias: bool = False,
    debug_level_alias_2: str | None = None,
    timing_on_flag: bool = False,
    help_flag_alias: bool = False,
    flobs_prior_off_alias: bool = False,
    flobs_dir: str | None = None,
    prior_covar_file_alias: InputPathType | None = None,
    prior_mean_file_alias: InputPathType | None = None,
    log_dir_alias_2: str | None = None,
    num_iterations: int | None = 5,
    temporal_ar_mrf_prec_alias: float | None = -1,
    temporal_ar_flag: bool = False,
    num_trace_samples_alias: int | None = 0,
    temporal_ar_order: int | None = 3,
    runner: Runner | None = None,
) -> FilmbabeOutputs:
    """
    FILM with MCMC-based Bayesian Analysis for fMRI.
    
    Author: FMRIB Analysis Group, University of Oxford
    
    URL: https://fsl.fmrib.ox.ac.uk/fsl/fslwiki
    
    Args:
        datafile_alias: Data file.
        mask_alias: Mask file.
        designfile_alias_2: Design matrix file.
        frf: File indicating which regressors belong to which original EV\
            design matrix file (a -1 label indicates a non-flobs regressor).
        verbose_flag_alias: Switch on diagnostic messages.
        debug_level_alias_2: Set debug level.
        timing_on_flag: Turn timing on.
        help_flag_alias: Display help message.
        flobs_prior_off_alias: Turn FLOBS prior off.
        flobs_dir: FLOBS directory; required when using FLOBS constraints.
        prior_covar_file_alias: Prior covariance matrix file.
        prior_mean_file_alias: Prior mean matrix file.
        log_dir_alias_2: Log directory.
        num_iterations: Number of VB iterations; default is 5.
        temporal_ar_mrf_prec_alias: MRF precision to impose on temporal AR\
            maps, default is -1 for a proper full Bayes approach.
        temporal_ar_flag: Impose ARD/MRF on temporal AR.
        num_trace_samples_alias: Number of samples to take to estimate trace;\
            default is 0 (uses only diagonal elements of precision matrix to\
            estimate trace).
        temporal_ar_order: Order of temporal AR; default is 3.
        runner: Command runner.
    Returns:
        NamedTuple of outputs (described in `FilmbabeOutputs`).
    """
    runner = runner or get_global_runner()
    execution = runner.start_execution(FILMBABE_METADATA)
    params = filmbabe_params(datafile_alias=datafile_alias, mask_alias=mask_alias, designfile_alias_2=designfile_alias_2, frf=frf, verbose_flag_alias=verbose_flag_alias, debug_level_alias_2=debug_level_alias_2, timing_on_flag=timing_on_flag, help_flag_alias=help_flag_alias, flobs_prior_off_alias=flobs_prior_off_alias, flobs_dir=flobs_dir, prior_covar_file_alias=prior_covar_file_alias, prior_mean_file_alias=prior_mean_file_alias, log_dir_alias_2=log_dir_alias_2, num_iterations=num_iterations, temporal_ar_mrf_prec_alias=temporal_ar_mrf_prec_alias, temporal_ar_flag=temporal_ar_flag, num_trace_samples_alias=num_trace_samples_alias, temporal_ar_order=temporal_ar_order)
    return filmbabe_execute(params, execution)


__all__ = [
    "FILMBABE_METADATA",
    "FilmbabeOutputs",
    "filmbabe",
    "filmbabe_params",
]
